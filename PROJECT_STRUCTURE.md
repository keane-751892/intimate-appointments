# ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

## å®Œæ•´é¡¹ç›®ç»“æ„

```
intimate-appointments/
â”œâ”€â”€ server/                          # åç«¯æœåŠ¡å™¨
â”‚   â””â”€â”€ index.js                     # Express + Socket.io æœåŠ¡å™¨
â”‚
â”œâ”€â”€ public/                          # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html                   # ä¸»HTMLé¡µé¢ï¼ˆå•é¡µåº”ç”¨ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ css/                         # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ variables.css            # CSSå˜é‡å’Œå…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ auth.css                 # è®¤è¯é¡µé¢æ ·å¼
â”‚   â”‚   â”œâ”€â”€ dashboard.css            # ä¸»ç•Œé¢æ ·å¼
â”‚   â”‚   â””â”€â”€ appointments.css         # æ¨¡æ€æ¡†å’Œç»„ä»¶æ ·å¼
â”‚   â”‚
â”‚   â””â”€â”€ js/                          # JavaScriptä»£ç 
â”‚       â”œâ”€â”€ main.js                  # ä¸»å…¥å£å’Œå…¨å±€é…ç½®
â”‚       â”œâ”€â”€ auth.js                  # ç”¨æˆ·è®¤è¯é€»è¾‘
â”‚       â”œâ”€â”€ appointment.js           # é¢„çº¦ç®¡ç†é€»è¾‘
â”‚       â”‚
â”‚       â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚           â”œâ”€â”€ storage.js           # æœ¬åœ°å­˜å‚¨ç®¡ç†
â”‚           â”œâ”€â”€ crypto.js            # åŠ å¯†è§£å¯†å·¥å…·
â”‚           â””â”€â”€ notification.js      # é€šçŸ¥ç³»ç»Ÿ
â”‚
â”œâ”€â”€ package.json                     # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                       # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ Dockerfile                       # Dockeré•œåƒé…ç½®
â”œâ”€â”€ docker-compose.yml               # Docker Composeé…ç½®
â”œâ”€â”€ setup.sh                         # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ README.md                        # å®Œæ•´é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md                    # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â””â”€â”€ PROJECT_STRUCTURE.md             # æœ¬æ–‡ä»¶ - é¡¹ç›®ç»“æ„è¯´æ˜
```

## æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### åç«¯æ–‡ä»¶

#### `server/index.js`
- **åŠŸèƒ½**: ExpressæœåŠ¡å™¨ + WebSocketæœåŠ¡å™¨
- **ä¸»è¦ç»„ä»¶**:
  - Express REST API
  - Socket.io WebSocketæœåŠ¡å™¨
  - MongoDBè¿æ¥å’Œæ¨¡å‹
  - JWTè®¤è¯ä¸­é—´ä»¶
  - ç”¨æˆ·å’Œé¢„çº¦APIç«¯ç‚¹
- **ç«¯å£**: 3000ï¼ˆå¯é€šè¿‡.envé…ç½®ï¼‰

### å‰ç«¯æ–‡ä»¶

#### `public/index.html`
- **åŠŸèƒ½**: å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸»é¡µé¢
- **åŒ…å«**:
  - ç™»å½•/æ³¨å†Œç•Œé¢
  - ä¸»ä»ªè¡¨æ¿ç•Œé¢
  - æ‰€æœ‰æ¨¡æ€æ¡†ï¼ˆåˆ›å»ºé¢„çº¦ã€ä¿®æ”¹é¢„çº¦ã€ç»‘å®šä¼´ä¾£ï¼‰
  - é€šçŸ¥å®¹å™¨

#### CSSæ ·å¼æ–‡ä»¶

##### `css/variables.css`
- CSSå˜é‡å®šä¹‰ï¼ˆé¢œè‰²ã€å­—ä½“ã€é—´è·ç­‰ï¼‰
- å…¨å±€æ ·å¼é‡ç½®
- åŸºç¡€ç»„ä»¶æ ·å¼

##### `css/auth.css`
- è®¤è¯é¡µé¢æ ·å¼
- ç™»å½•/æ³¨å†Œè¡¨å•
- æ¬¢è¿åŠ¨ç”»

##### `css/dashboard.css`
- ä¸»ç•Œé¢å¸ƒå±€
- å¯¼èˆªæ 
- é¢„çº¦åˆ—è¡¨
- é€šçŸ¥ç³»ç»Ÿ

##### `css/appointments.css`
- æ¨¡æ€æ¡†æ ·å¼
- è¡¨å•ç»„ä»¶
- å†å²è®°å½•
- å¤‡ä»½/æ¢å¤ç•Œé¢

#### JavaScriptæ–‡ä»¶

##### `js/main.js`
- **åŠŸèƒ½**: åº”ç”¨åˆå§‹åŒ–å’Œå…¨å±€é…ç½®
- **ä¸»è¦å†…å®¹**:
  - ç½‘ç»œçŠ¶æ€ç›‘å¬
  - é”®ç›˜å¿«æ·é”®
  - é¡µé¢å¯è§æ€§ç›‘å¬
  - è‡ªåŠ¨åŒæ­¥å’Œå¤‡ä»½
  - æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥
  - é”™è¯¯å¤„ç†

##### `js/auth.js`
- **åŠŸèƒ½**: ç”¨æˆ·è®¤è¯ç®¡ç†
- **ä¸»è¦å†…å®¹**:
  - `AuthManager` ç±»
  - ç™»å½•/æ³¨å†Œ/ç™»å‡º
  - ä¼´ä¾£ç»‘å®š
  - WebSocketè®¤è¯
  - ä¼šè¯ç®¡ç†

##### `js/appointment.js`
- **åŠŸèƒ½**: é¢„çº¦ç®¡ç†
- **ä¸»è¦å†…å®¹**:
  - `AppointmentManager` ç±»
  - åˆ›å»º/ä¿®æ”¹/åˆ é™¤é¢„çº¦
  - é¢„çº¦çŠ¶æ€æ›´æ–°
  - é¢„çº¦åˆ—è¡¨æ¸²æŸ“
  - è¿‡æ»¤å’Œæ’åº

##### `js/utils/storage.js`
- **åŠŸèƒ½**: æœ¬åœ°æ•°æ®å­˜å‚¨ç®¡ç†
- **ä¸»è¦å†…å®¹**:
  - `StorageManager` ç±»
  - Tokenå’Œç”¨æˆ·ä¿¡æ¯å­˜å‚¨
  - é¢„çº¦æ•°æ®ç¼“å­˜
  - è‡ªåŠ¨å¤‡ä»½
  - æ•°æ®å¯¼å…¥/å¯¼å‡º

##### `js/utils/crypto.js`
- **åŠŸèƒ½**: æ•°æ®åŠ å¯†è§£å¯†
- **ä¸»è¦å†…å®¹**:
  - `CryptoManager` ç±»
  - AES-GCMåŠ å¯†
  - å¯†ç å“ˆå¸Œ
  - æ•°æ®æ··æ·†
  - `SecureStorage` ç±»

##### `js/utils/notification.js`
- **åŠŸèƒ½**: é€šçŸ¥ç³»ç»Ÿ
- **ä¸»è¦å†…å®¹**:
  - `NotificationManager` ç±»
  - åº”ç”¨å†…é€šçŸ¥
  - æµè§ˆå™¨åŸç”Ÿé€šçŸ¥
  - é€šçŸ¥åŠ¨ç”»
  - é€šçŸ¥ç®¡ç†

## æ•°æ®æµ

### è®¤è¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥å‡­è¯
    â†“
auth.js (å‰ç«¯)
    â†“
POST /api/auth/login
    â†“
server/index.js (åç«¯)
    â†“
éªŒè¯å‡­è¯ â†’ ç”ŸæˆJWT
    â†“
è¿”å›Token + ç”¨æˆ·ä¿¡æ¯
    â†“
å­˜å‚¨åˆ°localStorage
    â†“
åˆå§‹åŒ–WebSocketè¿æ¥
```

### é¢„çº¦åˆ›å»ºæµç¨‹

```
ç”¨æˆ·å¡«å†™è¡¨å•
    â†“
appointment.js (å‰ç«¯)
    â†“
POST /api/appointments
    â†“
server/index.js (åç«¯)
    â†“
ä¿å­˜åˆ°MongoDB
    â†“
WebSocketæ¨é€é€šçŸ¥
    â†“
ä¼´ä¾£æ”¶åˆ°é€šçŸ¥
    â†“
åˆ·æ–°é¢„çº¦åˆ—è¡¨
```

### å®æ—¶é€šçŸ¥æµç¨‹

```
æœåŠ¡å™¨äº‹ä»¶è§¦å‘
    â†“
Socket.ioæœåŠ¡å™¨
    â†“
WebSocketè¿æ¥
    â†“
å®¢æˆ·ç«¯æ¥æ”¶äº‹ä»¶
    â†“
notification.js (å‰ç«¯)
    â†“
æ˜¾ç¤ºé€šçŸ¥ï¼ˆåº”ç”¨å†… + æµè§ˆå™¨ï¼‰
```

## APIç«¯ç‚¹æ€»è§ˆ

### è®¤è¯ç›¸å…³
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/bind-partner` - ç»‘å®šä¼´ä¾£
- `GET /api/auth/partner` - è·å–ä¼´ä¾£ä¿¡æ¯

### é¢„çº¦ç›¸å…³
- `POST /api/appointments` - åˆ›å»ºé¢„çº¦
- `GET /api/appointments` - è·å–é¢„çº¦åˆ—è¡¨
- `PUT /api/appointments/:id/status` - æ›´æ–°é¢„çº¦çŠ¶æ€
- `PUT /api/appointments/:id` - ä¿®æ”¹é¢„çº¦

## WebSocketäº‹ä»¶

### å®¢æˆ·ç«¯å‘é€
- `authenticate` - è®¤è¯WebSocketè¿æ¥

### æœåŠ¡å™¨æ¨é€
- `new-appointment` - æ–°é¢„çº¦é€šçŸ¥
- `appointment-updated` - é¢„çº¦çŠ¶æ€æ›´æ–°
- `appointment-modified` - é¢„çº¦è¢«ä¿®æ”¹
- `auth-error` - è®¤è¯å¤±è´¥

## å®‰å…¨æœºåˆ¶

### 1. è®¤è¯å®‰å…¨
- JWTä»¤ç‰Œè®¤è¯
- å¯†ç bcryptjså“ˆå¸Œ
- Tokenè¿‡æœŸæ—¶é—´ï¼ˆ7å¤©ï¼‰

### 2. æ•°æ®åŠ å¯†
- AES-GCMåŠ å¯†
- æœ¬åœ°æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- WebSocketè®¤è¯

### 3. éšç§ä¿æŠ¤
- å¤«å¦»é…å¯¹éš”ç¦»
- æ•°æ®ä»…å­˜å‚¨åœ¨ç§æœ‰æœåŠ¡å™¨
- ä¸æ”¶é›†ä»»ä½•ç”¨æˆ·ç»Ÿè®¡æ•°æ®

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°åŠŸèƒ½

1. **åç«¯API**ï¼š
   - åœ¨ `server/index.js` æ·»åŠ æ–°çš„è·¯ç”±
   - å®ç°ä¸šåŠ¡é€»è¾‘
   - è¿”å›JSONå“åº”

2. **å‰ç«¯UI**ï¼š
   - åœ¨ `public/index.html` æ·»åŠ HTMLç»“æ„
   - åœ¨ `css/` ç›®å½•æ·»åŠ æˆ–ä¿®æ”¹æ ·å¼
   - åœ¨ `js/` ç›®å½•å®ç°åŠŸèƒ½é€»è¾‘

3. **WebSocketäº‹ä»¶**ï¼š
   - åç«¯ï¼š`io.emit('event-name', data)`
   - å‰ç«¯ï¼š`socket.on('event-name', callback)`

### è‡ªå®šä¹‰æ ·å¼

ä¿®æ”¹ `css/variables.css` ä¸­çš„CSSå˜é‡ï¼š

```css
:root {
  --primary-color: #FF6B6B;          /* ä¸»è‰²è°ƒ */
  --secondary-color: #FFD93D;        /* è¾…åŠ©è‰² */
  --bg-color: #FFF8E7;               /* èƒŒæ™¯è‰² */
  /* ... æ›´å¤šå˜é‡ */
}
```

### æ•°æ®åº“æ¨¡å‹

å½“å‰æ¨¡å‹ï¼š
- `User` - ç”¨æˆ·æ¨¡å‹
- `Appointment` - é¢„çº¦æ¨¡å‹

æ·»åŠ æ–°æ¨¡å‹ï¼š
```javascript
const newSchema = new mongoose.Schema({
  // å­—æ®µå®šä¹‰
});

const NewModel = mongoose.model('NewModel', newSchema);
```

## æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- âœ… æœ¬åœ°æ•°æ®ç¼“å­˜
- âœ… æ‡’åŠ è½½ç»„ä»¶
- âœ… é˜²æŠ–/èŠ‚æµå¤„ç†
- âœ… å›¾ç‰‡æ‡’åŠ è½½ï¼ˆæœªæ¥ï¼‰

### åç«¯ä¼˜åŒ–
- âœ… MongoDBç´¢å¼•
- âœ… WebSocketè¿æ¥æ± 
- âœ… JWTç¼“å­˜ï¼ˆæœªæ¥Redisï¼‰
- âœ… APIå“åº”å‹ç¼©ï¼ˆæœªæ¥ï¼‰

## æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•
1. æ‰“å¼€ä¸¤ä¸ªä¸åŒçš„æµè§ˆå™¨
2. åˆ†åˆ«æ³¨å†Œä¸¤ä¸ªè´¦å·
3. äº’ç›¸ç»‘å®šä¼´ä¾£å…³ç³»
4. åˆ›å»ºé¢„çº¦å¹¶æµ‹è¯•å®æ—¶é€šçŸ¥

### è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- E2Eæµ‹è¯•

## éƒ¨ç½²æµç¨‹

1. **å¼€å‘ç¯å¢ƒ**ï¼š`npm run dev`
2. **æµ‹è¯•ç¯å¢ƒ**ï¼š`npm start`
3. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨PM2æˆ–Docker

## ç»´æŠ¤å»ºè®®

### å®šæœŸä»»åŠ¡
- æ¯å‘¨ï¼šæ£€æŸ¥æ—¥å¿—æ–‡ä»¶
- æ¯æœˆï¼šæ¸…ç†è¿‡æœŸå¤‡ä»½
- æ¯å­£åº¦ï¼šæ›´æ–°ä¾èµ–åŒ…
- æ¯å¹´ï¼šæ›´æ–°SSLè¯ä¹¦

### ç›‘æ§æŒ‡æ ‡
- åº”ç”¨è¿è¡Œæ—¶é—´
- å†…å­˜ä½¿ç”¨ç‡
- WebSocketè¿æ¥æ•°
- APIå“åº”æ—¶é—´

## å¸¸ç”¨å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start

# ä½¿ç”¨PM2å¯åŠ¨
pm2 start ecosystem.config.js

# Dockerå¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/out.log

# æ¸…ç†æ•°æ®
mongosh --eval "use intimate_appointments; db.users.deleteMany({}); db.appointments.deleteMany({});"
```

---

**é¡¹ç›®æŠ€æœ¯æ ˆ**: Node.js + Express + Socket.io + MongoDB + Vanilla JavaScript

**æœ€åæ›´æ–°**: 2024-01-10

**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
